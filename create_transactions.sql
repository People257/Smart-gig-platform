CREATE TABLE IF NOT EXISTS `transactions` (`id` BIGINT NOT NULL AUTO_INCREMENT, `uuid` VARCHAR(36) NOT NULL UNIQUE, `user_id` BIGINT NOT NULL, `task_assignment_id` BIGINT NULL, `type` VARCHAR(20) NOT NULL, `amount` DECIMAL(10,2) NOT NULL, `currency` CHAR(3) NOT NULL DEFAULT 'CNY', `status` VARCHAR(20) NOT NULL, `title` VARCHAR(100) NOT NULL, `description` TEXT NULL, `reference_id` BIGINT NULL, `reference_type` VARCHAR(20) NULL, `reference_uuid` VARCHAR(36) NULL, `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP, `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, `completed_at` TIMESTAMP NULL, PRIMARY KEY (`id`), INDEX `idx_transactions_uuid` (`uuid`), INDEX `idx_transactions_user_id` (`user_id`), INDEX `idx_transactions_task_assignment_id` (`task_assignment_id`), INDEX `idx_transactions_reference_id` (`reference_id`), INDEX `idx_transactions_reference_type` (`reference_type`), INDEX `idx_transactions_reference_uuid` (`reference_uuid`), CONSTRAINT `fk_transactions_user_id` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE RESTRICT ON UPDATE NO ACTION, CONSTRAINT `fk_transactions_task_assignment_id` FOREIGN KEY (`task_assignment_id`) REFERENCES `task_assignments` (`id`) ON DELETE SET NULL ON UPDATE NO ACTION) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
